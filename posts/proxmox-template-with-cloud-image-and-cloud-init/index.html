<!DOCTYPE html><html lang="en" data-mode="dark" ><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Proxmox Template with Cloud Image and Cloud Init" /><meta name="author" content="Steven Marks" /><meta property="og:locale" content="en" /><meta name="description" content="Updated to latest Ubuntu image &amp; Added enable for qemu service" /><meta property="og:description" content="Updated to latest Ubuntu image &amp; Added enable for qemu service" /><link rel="canonical" href="https://totaldebug.uk/posts/proxmox-template-with-cloud-image-and-cloud-init/" /><meta property="og:url" content="https://totaldebug.uk/posts/proxmox-template-with-cloud-image-and-cloud-init/" /><meta property="og:site_name" content="TotalDebug" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-10-04T19:54:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Proxmox Template with Cloud Image and Cloud Init" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Steven Marks"},"dateModified":"2023-06-08T15:10:06+01:00","datePublished":"2022-10-04T19:54:00+01:00","description":"Updated to latest Ubuntu image &amp; Added enable for qemu service","headline":"Proxmox Template with Cloud Image and Cloud Init","mainEntityOfPage":{"@type":"WebPage","@id":"https://totaldebug.uk/posts/proxmox-template-with-cloud-image-and-cloud-init/"},"url":"https://totaldebug.uk/posts/proxmox-template-with-cloud-image-and-cloud-init/"}</script><title>Proxmox Template with Cloud Image and Cloud Init | TotalDebug</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="TotalDebug"><meta name="application-name" content="TotalDebug"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous" /><link rel="dns-prefetch" href="https://www.googletagmanager.com" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css" /><link rel="stylesheet" href="/assets/css/style.css" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.min.js"></script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/logo.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">TotalDebug</a></div><div class="site-subtitle font-italic">Technology. Inside Out</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="bi bi-house ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="bi bi-list-nested ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="bi bi-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="bi bi-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="bi bi-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/works/" class="nav-link"> <i class="bi bi-kanban ml-xl-3 mr-xl-3 unloaded"></i> <span>WORKS</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/marksie1988" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="bi bi-github"></i> </a> <a href="https://www.linkedin.com/in/marksie1988" aria-label="linkedin" target="_blank" rel="noopener noreferrer"> <i class="bi bi-linkedin"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="bi bi-rss"></i> </a> <a href="https://discord.gg/6fmekudc8Q" aria-label="discord" > <i class="bi bi-discord"></i> </a> <a href="https://github.com/marksie1988" aria-label="github" > <i class="bi bi-github"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Proxmox Template with Cloud Image and Cloud Init</span> </span> <i id="sidebar-trigger" class="bi bi-list"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="bi bi-search"></i> <span id="search-wrapper" class="align-items-center"> <i class="bi bi-search"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Proxmox Template with Cloud Image and Cloud Init</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1664909640" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Oct 4, 2022 </em> </span> <span> Updated <em class="" data-ts="1686233406" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jun 8, 2023 </em> </span><div class="mt-3 mb-3 post-thumbnail"><figure><picture> <source type="image/webp" srcset="/assets/img/posts/proxmox-template-with-cloud-image-and-cloud-init/thumb.webp" /> <a href="/assets/img/posts/proxmox-template-with-cloud-image-and-cloud-init/thumb.png" class="popup img-link post-title-img"><img data-src="/assets/img/posts/proxmox-template-with-cloud-image-and-cloud-init/thumb.png" alt="Preview Image" class="lazyload" data-proofer-ignore></a> </picture></figure></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/marksie1988">Steven Marks</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="678 words"> <em>3 min</em> read</span></div></div><div class="row justify-content-center" id="post-series"><div class="card series-list"><div class="card-header"> AUTOMATING PROXMOX DEPLOYMENTS (2 part series)</div><ul class="list-group list-group-flush"> <a href="#" class="list-group-item list-group-item-action active" aria-current="true">Proxmox Template with Cloud Image and Cloud Init</a> <a href="/posts/automating-proxmox-with-terraform-ansible/" class="list-group-item list-group-item-action">Automating deployments using Terraform with Proxmox and ansible</a></ul></div></div></div><div class="d-none"><div id="posted-date">1664909640</div><div id="updated-date">1686233406</div></div><blockquote class="d-none prompt-info" id="post-age-notification"></blockquote><div class="post-content"><blockquote class="prompt-info"><p>Updated to latest Ubuntu image &amp; Added enable for qemu service</p></blockquote><p>Using Cloud images and Cloud init with Proxmox is the quickest, most efficient way to deploy servers at this time. Cloud images are small cloud certified that have Cloud init pre-installed and ready to accept configuration.</p><p>Cloud images and Cloud init also work with Proxmox and if you combine this with Terraform you have a fully automated deployment model. See <a href="/posts/automating-proxmox-with-terraform-ansible/">Automating deployments using Terraform with Proxmox and ansible</a> for instructions on how to do this. int</p><h2 id="guide"><span class="mr-2">Guide</span><a href="#guide" class="anchor text-muted"><i class="bi bi-hash"></i></a></h2><h3 id="download-image"><span class="mr-2">Download image</span><a href="#download-image" class="anchor text-muted"><i class="bi bi-hash"></i></a></h3><p>First you will need to choose an <a href="https://cloud-images.ubuntu.com/">Ubuntu Cloud Image</a></p><p>Rather than downloading this, copy the URL.</p><p>Then SSH into your Proxmox server and run wget with the URL you just copied, similar to below:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>wget https://cloud-images.ubuntu.com/jammy/current/jammy-server-cloudimg-amd64.img
</pre></table></code></div></div><p>This will download the image onto your proxmox server ready for use.</p><h3 id="install-packages"><span class="mr-2">Install packages</span><a href="#install-packages" class="anchor text-muted"><i class="bi bi-hash"></i></a></h3><p>The <code class="language-plaintext highlighter-rouge">qemu-guest-agent</code> is not installed on the cloud-images, so we need a way to inject that into out image file. This can be done with a great tool called <code class="language-plaintext highlighter-rouge">virt-customize</code> this is installed with the package <code class="language-plaintext highlighter-rouge">libguestfs-tools</code>. <a href="https://www.libguestfs.org/">libguestfs</a> is a set of tools for accessing and modifying virtual machine (VM) disk images.</p><p>Install:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>apt update <span class="nt">-y</span> <span class="o">&amp;&amp;</span> <span class="nb">sudo </span>apt <span class="nb">install </span>libguestfs-tools <span class="nt">-y</span>
</pre></table></code></div></div><p>Install <code class="language-plaintext highlighter-rouge">qemu-guest-agent</code> into the downloaded image:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>virt-customize <span class="nt">-a</span> jammy-server-cloudimg-amd64.img <span class="nt">--install</span> qemu-guest-agent <span class="nt">--run-command</span> <span class="s1">'systemctl enable qemu-guest-agent.service'</span>
</pre></table></code></div></div><p>You can also install other packages at this point.</p><h3 id="adding-users-to-the-image-optional"><span class="mr-2">Adding users to the image (Optional)</span><a href="#adding-users-to-the-image-optional" class="anchor text-muted"><i class="bi bi-hash"></i></a></h3><p>It is possible to also add a user and SSH keys with the <code class="language-plaintext highlighter-rouge">virt-customize</code>. This is useful for automation such as terraform.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>virt-customize <span class="nt">-a</span> jammy-server-cloudimg-amd64.img <span class="nt">--run-command</span> <span class="s1">'useradd simone'</span>
<span class="nb">sudo </span>virt-customize <span class="nt">-a</span> jammy-server-cloudimg-amd64.img <span class="nt">--run-command</span> <span class="s1">'mkdir -p /home/simone/.ssh'</span>
<span class="nb">sudo </span>virt-customize <span class="nt">-a</span> jammy-server-cloudimg-amd64.img <span class="nt">--ssh-inject</span> simone:file:id_ed25519.pub
<span class="nb">sudo </span>virt-customize <span class="nt">-a</span> jammy-server-cloudimg-amd64.img <span class="nt">--run-command</span> <span class="s1">'chown -R simone:simone /home/simone'</span>
</pre></table></code></div></div><ol><li>Adds the user to the image<li>Makes the SSH Key directory<li>Injects the SSH Key. <code class="language-plaintext highlighter-rouge">simone</code> is the user the key will apply to, <code class="language-plaintext highlighter-rouge">file:id_ed25519.pub</code> is the file on the local host where the SSH Key is located<li>Makes sure the user simone owns the home folder</ol><h3 id="create-a-virtual-machine-from-the-image"><span class="mr-2">Create a virtual machine from the image</span><a href="#create-a-virtual-machine-from-the-image" class="anchor text-muted"><i class="bi bi-hash"></i></a></h3><p>Now we need to create a new virtual machine:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>qm create 9000 <span class="nt">--memory</span> 2048 <span class="nt">--core</span> 2 <span class="nt">--name</span> jammy-template <span class="nt">--net0</span> virtio,bridge<span class="o">=</span>vmbr0
</pre></table></code></div></div><p>Import the downloaded Ubuntu disk to the correct storage:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>qm importdisk 9000 jammy-server-cloudimg-amd64.img local-lvm
</pre></table></code></div></div><p>Attach the new disk as a SCSI drive on the SCSI Controller:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>qm <span class="nb">set </span>9000 <span class="nt">--scsihw</span> virtio-scsi-pci <span class="nt">--scsi0</span> local-lvm:vm-9000-disk-0
</pre></table></code></div></div><p>Add cloud init drive:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>qm <span class="nb">set </span>9000 <span class="nt">--ide2</span> local-lvm:cloudinit
</pre></table></code></div></div><p>Make the could init drive bootable and restrict BIOS to boot from disk only:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>qm <span class="nb">set </span>9000 <span class="nt">--boot</span> c <span class="nt">--bootdisk</span> scsi0
</pre></table></code></div></div><p>Add serial console:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>qm <span class="nb">set </span>9000 <span class="nt">--serial0</span> socket <span class="nt">--vga</span> serial0
</pre></table></code></div></div><p>Turn on guest agent:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>qm <span class="nb">set </span>9000 <span class="nt">--agent</span> <span class="nv">enabled</span><span class="o">=</span>1
</pre></table></code></div></div><blockquote class="prompt-warning"><p>DO NOT POWER ON THE VM</p></blockquote><h3 id="convert-the-vm-to-a-template"><span class="mr-2">Convert the VM to a Template</span><a href="#convert-the-vm-to-a-template" class="anchor text-muted"><i class="bi bi-hash"></i></a></h3><p>Now, Create a template from the image you just created:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>qm template 9000
</pre></table></code></div></div><h2 id="clone-the-template-to-a-vm"><span class="mr-2">Clone the template to a VM</span><a href="#clone-the-template-to-a-vm" class="anchor text-muted"><i class="bi bi-hash"></i></a></h2><p>Now you have a fully functioning template, which can be cloned as much as you want. But it makes sense to set some of the settings.</p><p>First, clone the VM (here we are cloning the template with ID 9000 to a new VM with ID 999):</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>qm clone 9000 999 <span class="nt">--name</span> test-cloud-init
</pre></table></code></div></div><p>Next, set the SSH keys (if you didn’t add yours earlier) and IP address:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>qm <span class="nb">set </span>999 <span class="nt">--sshkey</span> ~/.ssh/id_rsa.pub
<span class="nb">sudo </span>qm <span class="nb">set </span>999 <span class="nt">--ipconfig0</span> <span class="nv">ip</span><span class="o">=</span>10.10.1.20/24,gw<span class="o">=</span>10.10.1.1
</pre></table></code></div></div><p>It’s now ready to start up!</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>qm start 999
</pre></table></code></div></div><p>You should be able to log in without any problems (after trusting the SSH fingerprint). Note that the username is <code class="language-plaintext highlighter-rouge">ubuntu</code>, for the key set here. If you added your own user earlier, you can use that instead</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ssh ubuntu@10.10.1.1
</pre></table></code></div></div><p>Once happy with the template, you can stop the VM and clean up the resources:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>qm stop 999 <span class="o">&amp;&amp;</span> <span class="nb">sudo </span>qm destroy 999
<span class="nb">rm </span>jammy-server-cloudimg-amd64.img
</pre></table></code></div></div><h2 id="references"><span class="mr-2">References</span><a href="#references" class="anchor text-muted"><i class="bi bi-hash"></i></a></h2><p><a href="https://registry.terraform.io/modules/sdhibit/cloud-init-vm/proxmox/latest/examples/ubuntu_single_vm">https://registry.terraform.io/modules/sdhibit/cloud-init-vm/proxmox/latest/examples/ubuntu_single_vm</a></p><h2 id="closing"><span class="mr-2">Closing</span><a href="#closing" class="anchor text-muted"><i class="bi bi-hash"></i></a></h2><p>Hopefully this information was useful for you, If you have any questions about this article and share your thoughts head over to my <a href="https://discord.gg/6fmekudc8Q">Discord</a>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="bi bi-folder2-open mr-1"></i> <a href="/categories/automation/" >Automation</a ></div><div class="post-tags"> <i class="bi bi-tags mr-1"></i> <a href="/tags/proxmox/" class="post-tag no-text-decoration" >proxmox</a> <a href="/tags/ubuntu/" class="post-tag no-text-decoration" >ubuntu</a> <a href="/tags/cloud-init/" class="post-tag no-text-decoration" >cloud-init</a> <a href="/tags/cloud-image/" class="post-tag no-text-decoration" >cloud-image</a> <a href="/tags/linux/" class="post-tag no-text-decoration" >linux</a> <a href="/tags/clone/" class="post-tag no-text-decoration" >clone</a> <a href="/tags/template/" class="post-tag no-text-decoration" >template</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2" ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Proxmox%20Template%20with%20Cloud%20Image%20and%20Cloud%20Init%20-%20TotalDebug&url=https%3A%2F%2Ftotaldebug.uk%2Fposts%2Fproxmox-template-with-cloud-image-and-cloud-init%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw bi bi-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Proxmox%20Template%20with%20Cloud%20Image%20and%20Cloud%20Init%20-%20TotalDebug&u=https%3A%2F%2Ftotaldebug.uk%2Fposts%2Fproxmox-template-with-cloud-image-and-cloud-init%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw bi bi-facebook"></i> </a> <a href="https://telegram.me/share?text=Proxmox%20Template%20with%20Cloud%20Image%20and%20Cloud%20Init%20-%20TotalDebug&url=https%3A%2F%2Ftotaldebug.uk%2Fposts%2Fproxmox-template-with-cloud-image-and-cloud-init%2F" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw bi bi-telegram"></i> </a> <a href="https://news.ycombinator.com/submitlink?t=Proxmox%20Template%20with%20Cloud%20Image%20and%20Cloud%20Init%20-%20TotalDebug&u=https%3A%2F%2Ftotaldebug.uk%2Fposts%2Fproxmox-template-with-cloud-image-and-cloud-init%2F" data-toggle="tooltip" data-placement="top" title="HackerNews" target="_blank" rel="noopener" aria-label="HackerNews"> <i class="fa-fw bi bi-hacker-news"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Ftotaldebug.uk%2Fposts%2Fproxmox-template-with-cloud-image-and-cloud-init%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw bi bi-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/two-factor-authentication-worth-really-add-security/">Two-Factor Authentication: is it worth it, does it really add more security?</a><li><a href="/posts/last4solar-my-solar-nightmare/">Last4Solar - My solar nightmare!</a><li><a href="/posts/jekyll-post-series-links/">Add series links to Jekyll posts</a><li><a href="/posts/proxmox-template-with-cloud-image-and-cloud-init/">Proxmox Template with Cloud Image and Cloud Init</a><li><a href="/posts/automating-proxmox-with-terraform-ansible/">Automating deployments using Terraform with Proxmox and ansible</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/centos/">centos</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/unifi/">unifi</a> <a class="post-tag" href="/tags/best-practices/">best practices</a> <a class="post-tag" href="/tags/code-quality/">code quality</a> <a class="post-tag" href="/tags/automation/">automation</a> <a class="post-tag" href="/tags/configuration/">configuration</a> <a class="post-tag" href="/tags/container/">container</a> <a class="post-tag" href="/tags/exchange/">exchange</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/use-google-authenticator-ssh/"><div class="card-body"> <em class="small" data-ts="1389139200" data-df="ll" > Jan 8, 2014 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Use Google Authenticator for 2FA with SSH</h3><div class="text-muted small"><p> By default, SSH uses password authentication, most SSH hardening instructions recommend using SSH keys instead. However, SSH keys still only provide a single factor authentication, even though it i...</p></div></div></a></div><div class="card"> <a href="/posts/mikrotik-openvpn-server-with-linux-client/"><div class="card-body"> <em class="small" data-ts="1438124400" data-df="ll" > Jul 29, 2015 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Mikrotik OpenVPN Server with Linux Client</h3><div class="text-muted small"><p> I spent quite some time trying to get the OpenVPN Server working on the Mikrotik Router with a Linux client, It caused some pain and I didn’t want others to go through that. I have therefore writte...</p></div></div></a></div><div class="card"> <a href="/upgrade-linux-unifi-controller-minutes/"><div class="card-body"> <em class="small" data-ts="1488056596" data-df="ll" > Feb 25, 2017 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Upgrade your Linux UniFi Controller in minutes!</h3><div class="text-muted small"><p> Ubiquiti’s provide a Controller version for other distributions of linux but only display debian on their site, but if you’re running CentOS or another Linux distribution, you’ll have to use the ge...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/type-hinting-and-checking-in-python/" class="btn btn-outline-primary" prompt="Older"><p>Type hinting and checking in Python</p></a> <a href="/posts/homer-dashboard-with-docker/" class="btn btn-outline-primary" prompt="Newer"><p>Homer dashboard with Docker</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "totaldebug/totaldebug.uk", "data-repo-id": "MDEwOlJlcG9zaXRvcnkzMTkxMTkxNTE=", "data-category": "General", "data-category-id": "DIC_kwDOEwVfL84CPpH4", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/centos/">centos</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/unifi/">unifi</a> <a class="post-tag" href="/tags/best-practices/">best practices</a> <a class="post-tag" href="/tags/code-quality/">code quality</a> <a class="post-tag" href="/tags/automation/">automation</a> <a class="post-tag" href="/tags/configuration/">configuration</a> <a class="post-tag" href="/tags/container/">container</a> <a class="post-tag" href="/tags/exchange/">exchange</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/marksie1988">Steven Marks</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a></p></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button" > <i class="bi bi-chevron-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false" ><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close" > <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3"> A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="card post-preview"> <a style="text-decoration: none;" href="{url}"><div class="card-body"><h1 class="card-title"> {title}</h1><div class="card-text post-content"> {snippet}</div><div class="post-meta text-muted d-flex"><div class="mr-auto"> {categories} {tags}</div></div></div></a></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<i class="bi bi-folder"></i>${value}`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<i class="bi bi-tag"></i>${value}`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1.11.6/dayjs.min.js,npm/dayjs@1.11.6/locale/en.min.js,npm/dayjs@1.11.6/plugin/relativeTime.min.js,npm/dayjs@1.11.6/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-ZDGYQV98HT"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-ZDGYQV98HT'); }); </script>
