<!DOCTYPE html><html lang="en" data-mode="dark" ><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Mikrotik OpenVPN Server with Linux Client" /><meta name="author" content="Steven Marks" /><meta property="og:locale" content="en" /><meta name="description" content="I spent quite some time trying to get the OpenVPN Server working on the Mikrotik Router with a Linux client, It caused some pain and I didn’t want others to go through that. I have therefore written this guide, taking you from certificate creation all the way to VPN connectivity." /><meta property="og:description" content="I spent quite some time trying to get the OpenVPN Server working on the Mikrotik Router with a Linux client, It caused some pain and I didn’t want others to go through that. I have therefore written this guide, taking you from certificate creation all the way to VPN connectivity." /><link rel="canonical" href="https://totaldebug.uk/posts/mikrotik-openvpn-server-with-linux-client/" /><meta property="og:url" content="https://totaldebug.uk/posts/mikrotik-openvpn-server-with-linux-client/" /><meta property="og:site_name" content="TotalDebug" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2015-07-29T00:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Mikrotik OpenVPN Server with Linux Client" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Steven Marks"},"dateModified":"2022-10-27T16:24:01+01:00","datePublished":"2015-07-29T00:00:00+01:00","description":"I spent quite some time trying to get the OpenVPN Server working on the Mikrotik Router with a Linux client, It caused some pain and I didn’t want others to go through that. I have therefore written this guide, taking you from certificate creation all the way to VPN connectivity.","headline":"Mikrotik OpenVPN Server with Linux Client","mainEntityOfPage":{"@type":"WebPage","@id":"https://totaldebug.uk/posts/mikrotik-openvpn-server-with-linux-client/"},"url":"https://totaldebug.uk/posts/mikrotik-openvpn-server-with-linux-client/"}</script><title>Mikrotik OpenVPN Server with Linux Client | TotalDebug</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="TotalDebug"><meta name="application-name" content="TotalDebug"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous" /><link rel="dns-prefetch" href="https://www.googletagmanager.com" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css" /><link rel="stylesheet" href="/assets/css/style.css" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.min.js"></script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/logo.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">TotalDebug</a></div><div class="site-subtitle font-italic">Technology. Inside Out</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="bi bi-house ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="bi bi-list-nested ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="bi bi-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="bi bi-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="bi bi-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/works/" class="nav-link"> <i class="bi bi-kanban ml-xl-3 mr-xl-3 unloaded"></i> <span>WORKS</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/marksie1988" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="bi bi-github"></i> </a> <a href="https://www.linkedin.com/in/marksie1988" aria-label="linkedin" target="_blank" rel="noopener noreferrer"> <i class="bi bi-linkedin"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="bi bi-rss"></i> </a> <a href="https://discord.gg/6fmekudc8Q" aria-label="discord" > <i class="bi bi-discord"></i> </a> <a href="https://github.com/marksie1988" aria-label="github" > <i class="bi bi-github"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Mikrotik OpenVPN Server with Linux Client</span> </span> <i id="sidebar-trigger" class="bi bi-list"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="bi bi-search"></i> <span id="search-wrapper" class="align-items-center"> <i class="bi bi-search"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Mikrotik OpenVPN Server with Linux Client</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1438124400" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 29, 2015 </em> </span> <span> Updated <em class="" data-ts="1666884241" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Oct 27, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/marksie1988">Steven Marks</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1593 words"> <em>8 min</em> read</span></div></div></div><div class="post-content"><p>I spent quite some time trying to get the OpenVPN Server working on the Mikrotik Router with a Linux client, It caused some pain and I didn’t want others to go through that. I have therefore written this guide, taking you from certificate creation all the way to VPN connectivity.</p><p>For this tutorial I will have SSH to my Mikrotik (you can use a winbox terminal), I have chosen not to use WinBox for the configuration as its easier to deploy this way.</p><h3 id="certificate-creation"><span class="mr-2">Certificate Creation</span><a href="#certificate-creation" class="anchor text-muted"><i class="bi bi-hash"></i></a></h3><p>First we need to create our certificate templates on our Mikrotik.</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>/certificate
add <span class="nv">name</span><span class="o">=</span>ca-template <span class="nv">country</span><span class="o">=</span>GB <span class="nv">locality</span><span class="o">=</span>Leeds <span class="nv">organization</span><span class="o">=</span>SpottedHyena <span class="nv">state</span><span class="o">=</span>WestYorkshire common-name<span class="o">=</span><span class="s2">"home.server.co.uk"</span> key-size<span class="o">=</span>2048 <span class="nv">unit</span><span class="o">=</span>IT
</pre></table></code></div></div><p><strong>Name (Optional):</strong> This is the visual name for the template, set this as required. <strong>Country (Optional:</strong> The country that you are in, this should be denoted by the 2 letter prefix e.g. GB for Great Britain. <strong>Locality (Optional):</strong> This is the City / Town. <strong>Organization (Optional):</strong> If you are an Organization enter the name here. <strong>State (Optional):</strong> Your State / Province. <strong>Common-Name (Required):</strong> The common name should be the FQDN of your Server / Mikrotik, this cannot be an IP Address and must be a valid domain name accessible publicly. <strong>Key-Size (Optional):</strong> Although this is optional I would recommend setting it to at lease 2048 for security 1024 is the default and not as secure. <strong>Unit (Optional):</strong> this is the department the certificate belongs to.</p><p>Once we have generated our template we now need to create a certificate request and submit it to our CA</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>/certificate
create-certificate-request <span class="nv">template</span><span class="o">=</span>ca-template
</pre></table></code></div></div><p>Press enter and then type a passphrase, keep this safe it will be required when using the certificate.</p><p>Once the certificate is created you will get 2 new files, using an FTP Client such as <a href="https://filezilla-project.org/">Filezilla</a> connect to the Mikrotik and download these two files:</p><ol><li>certificate-request.pem<li>certificate-requset_key.pem</ol><p>Edit the certificate-request.pem file in your favourite <a href="https://notepad-plus-plus.org/">Notepad Product</a> copy all of the contents from this file including the begin and end tags.</p><p>Now we need to login to <a href="www.cacert.org">CAcert.org</a> (if you don’t have an account create one)</p><p>Once logged in select <strong>Domains</strong> <strong>Add</strong> in here type the domain name you used for your <strong>Common-Name</strong> e.g. 35.176.61.220 (you dont need the subdomain if one was used) You will then be asked to verify the domain via an email to one of a list of possible email accounts, verify the domain before continuing.</p><p>When the domain is verified go to <strong>Server Certificate</strong> <strong>New</strong></p><p>Paste the contents of certificate-request.pem into the box and submit the request.</p><p>This should be accepted straight away and you will receive your certificate in text form on the next page.</p><p>Copy and Paste your Certificate Response from Cacert in a notepad and save that with .pem file ( In Here : certificate-response.pem )</p><h3 id="private-key"><span class="mr-2">Private Key</span><a href="#private-key" class="anchor text-muted"><i class="bi bi-hash"></i></a></h3><p>We now need to convert the private key, this is generated in pkcs8 format, this is not supported by RouterOS.</p><p>To import the private key use linux openssl and make a private-key file.</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>yum <span class="nb">install </span>openssl
</pre></table></code></div></div><p>Upload the <code class="language-plaintext highlighter-rouge">certificate-requset_key.pem</code> file to the Linux server and run the following command:</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>openssl rsa <span class="nt">-in</span> certificate-requset_key.pem <span class="nt">-text</span>
</pre></table></code></div></div><p>copy and paste export String (Include Begin and End tags) to a New File eg <code class="language-plaintext highlighter-rouge">certificate-requset_key.key</code></p><h3 id="import-certificate"><span class="mr-2">Import Certificate</span><a href="#import-certificate" class="anchor text-muted"><i class="bi bi-hash"></i></a></h3><p>Upload the files Certificate-Response.pem, certificate-requset_key.key and <a href="http://www.cacert.org/?id=3">ca.crt (root ca from CACert.org)</a> to your Mikrotik with Filezilla</p><p>We now need to import the Certificate-response.pem with the passphrase you set earlier:</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>/certificate
import file-name<span class="o">=</span>certificate-response.pem
</pre></table></code></div></div><p>Now import the certificate-requset_key.key</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>/certificate
import file-name<span class="o">=</span>certificate-request_key.key
</pre></table></code></div></div><p>Now import the Intermidiate (CA Cert) from CACert.org</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre> /certificate
import file-name<span class="o">=</span>ca.crt
</pre></table></code></div></div><p><strong>Always import the certificate first, then the key.</strong> You should be able to do a /certificate print and see the entries for the files you imported. In the print output, look at the flags column and verify that the line with your certificate has a T and a K. If the K is missing, import the key one more time. If that still doesn’t work, ensure that your certificate and key match.</p><p>The default naming conventions used for certificates is a little confusing. You can rename a certificate by running <code class="language-plaintext highlighter-rouge">set name=firewall.35.176.61.220 number=0</code> (run a /certificate print to get the right number).</p><h3 id="openvpn-server-configuration"><span class="mr-2">OpenVPN Server Configuration</span><a href="#openvpn-server-configuration" class="anchor text-muted"><i class="bi bi-hash"></i></a></h3><p>(Credit to <a href="https://major.io/2015/05/01/howto-mikrotik-openvpn-server/">major.io</a> for parts of this section.</p><p>Now we are ready to begin the configuration of our OpenVPN Server</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>/interface ovpn-server server
<span class="nb">set </span><span class="nv">certificate</span><span class="o">=</span>firewall.35.176.61.220 <span class="nv">cipher</span><span class="o">=</span>aes256 default-profile<span class="o">=</span>default-encryption <span class="nv">enabled</span><span class="o">=</span><span class="nb">yes</span>
</pre></table></code></div></div><p>This tells the device that we want to use our certificate we created and imported earlier along with AES256 Ciphers, there are more ciphers available however at the time of writing AES256 was the most secure available. We are also selecting <strong>default-encryption</strong> profile, we will configure this in more detail later.</p><p>We now need to add an OpenVPN interface to the Mikrotik. You can have multiple OpenVPN Server profiles running under the same server. They will all share the same certificate, but each may have different configurations. Below we create the first profile:</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>/interface ovpn-server
add <span class="nv">name</span><span class="o">=</span>openvpn-inbound <span class="nv">user</span><span class="o">=</span>openvpn
</pre></table></code></div></div><p>There is now a profile with a username <strong>openvpn</strong>. That will be the username that we use to connect to this VPN server.</p><h3 id="secrets"><span class="mr-2">Secrets</span><a href="#secrets" class="anchor text-muted"><i class="bi bi-hash"></i></a></h3><p>The router needs a way to identify the user we just created:</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>/ppp secret
add <span class="nv">name</span><span class="o">=</span>openvpn <span class="nv">password</span><span class="o">=</span>ovpnpassword <span class="nv">profile</span><span class="o">=</span>default-encryption
</pre></table></code></div></div><h3 id="profiles"><span class="mr-2">Profiles</span><a href="#profiles" class="anchor text-muted"><i class="bi bi-hash"></i></a></h3><p>We have referred to this default-encryption profile and now it’s time to configure it. This is one of the things I prefer to configure using the Winbox GUI or the web interface since there are plenty of options to review. (in winbox select PPP then the profiles tab, open default-encryption profile)</p><p>The most important part is how you connect the VPN connection into your internal network. You have a few options here. You can configure an IP address that will always be assigned to this connection no matter what. There are upsides and downsides with that choice. You will always get the same IP on the inside network but you won’t be able to connect to the same profile with multiple clients.</p><p>I prefer to set the bridge option to my internal network bridge (which I call bridge1). That allows me to use my existing bridge configuration and filtering rules on my OpenVPN tunnels. My configuration looks something like this:</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>/ppp profile
<span class="nb">set </span>1 <span class="nv">bridge</span><span class="o">=</span>bridge1 local-address<span class="o">=</span>dhcp_pool1 only-one<span class="o">=</span>no remote-address<span class="o">=</span>dhcp_pool1
</pre></table></code></div></div><p>Here we have told the router that we want VPN Connections to use the main bridge, and should get its local and remote addresses from my normal DHCP Pool. In addition we are allowing multiple connections to this profile.</p><h3 id="firewall-rule"><span class="mr-2">Firewall Rule</span><a href="#firewall-rule" class="anchor text-muted"><i class="bi bi-hash"></i></a></h3><p>The following firewall rule will be required to allow traffic into the OpenVPN Port:</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>/ip firewall filter add <span class="nv">chain</span><span class="o">=</span>input dst-port<span class="o">=</span>1194 <span class="nv">protocol</span><span class="o">=</span>tcp
</pre></table></code></div></div><h3 id="openvpn-client"><span class="mr-2">OpenVPN Client</span><a href="#openvpn-client" class="anchor text-muted"><i class="bi bi-hash"></i></a></h3><p>This is where I got stuck the most, no articles explain where to get the Certificate for the Client from, for a seasoned pro this may seem like something very simple however to a newbie to this type of deployment its information I really could have done with!</p><p>Well the answer I now know is quite simple, you use the same Certificate for a Client and Server, Lots of articles I found mentioned having a client cert but that didn’t seem to work for me.</p><p>First we must install OpenVPN and create the configuration</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>yum <span class="nb">install </span>openvpn <span class="nt">-y</span>
</pre></table></code></div></div><p>The configuration files live here: /etc/openvpn/</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">cd</span> /etc/openvpn/
</pre></table></code></div></div><p>we will need to create <code class="language-plaintext highlighter-rouge">firewall-auth.txt</code> and <code class="language-plaintext highlighter-rouge">home.up</code> see the contents of these files below: <code class="language-plaintext highlighter-rouge">vi firewall-auth.txt</code></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>username
password
</pre></table></code></div></div><p>The firewall-auth.txt file holds our username and password, this will allow OpenVPN to login and restart the connection without user interaction.</p><h3 id="required-certificates"><span class="mr-2">Required Certificates:</span><a href="#required-certificates" class="anchor text-muted"><i class="bi bi-hash"></i></a></h3><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>openssl dhparam <span class="nt">-out</span> dh2048.pem 2048
</pre></table></code></div></div><p>This is our Diffie–Hellman file which is required by OpenVPN.</p><p>We also need to copy the following files ca.crt, certificate-response.crt and private-key.key</p><p><code class="language-plaintext highlighter-rouge">vi MyVpn.ovpn</code></p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>dev tun
pull
tls-client
dh dh2048.pem
ca ca.crt
cert certificate-response.crt
key certificate-request_key.key
remote firewall.35.176.61.220 1194 tcp-client
persist-key
script-security 3
cipher AES-256-CBC
auth-nocache
auth-user-pass firewall-auth.txt
ping 15
ping-restart 45
ping-timer-rem
persist-tun
verb 3
log-append /var/log/openvpn.log
</pre></table></code></div></div><p>This is the main configuration file, Below I have explained what each line means: <strong>dev tun:</strong> <strong>pull:</strong> <strong>tls-client:</strong> <strong>dh dh2048.pem:</strong> <strong>ca ca.crt:</strong> <strong>cert certificate-response.crt:</strong> <strong>key certificate-request_key.key:</strong> <strong>remote firewall.35.176.61.220 1194 tcp-client:</strong> <strong>persist-key</strong> <strong>script-security 3</strong> <strong>cipher AES-256-CBC</strong> <strong>auth-nocache</strong> <strong>auth-user-pass firewall-auth.txt</strong> <strong>ping 15</strong> <strong>ping-restart 45</strong> <strong>ping-timer-rem</strong> <strong>persist-tun</strong> <strong>verb 3</strong> <strong>log-append /var/log/openvpn.log</strong></p><h3 id="testing"><span class="mr-2">Testing</span><a href="#testing" class="anchor text-muted"><i class="bi bi-hash"></i></a></h3><p>To test the VPN is quite simple, open 2x SSH windows to your Client Linux Server.</p><p>In the first SSH Window run:</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>openvpn /etc/openvpn/MyVpn.ovpn
</pre></table></code></div></div><p>In the second SSH Window run:</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">tail</span> <span class="nt">-f</span> /var/log/openvpn.log
</pre></table></code></div></div><p>Watch the log closely, you will see errors in here which will help with troubleshooting any issues.</p><h3 id="troubleshooting"><span class="mr-2">Troubleshooting</span><a href="#troubleshooting" class="anchor text-muted"><i class="bi bi-hash"></i></a></h3><p><strong>Compression:</strong> At the time of writing compression is not supported by Mikrotik, please make sure no LZO lines are present in the configuration.</p><p><strong>Certificates:</strong> Check that your certificate and key were imported properly and that your client is configured to trust the self-signed certificate or the CA you used.</p><h3 id="security"><span class="mr-2">Security</span><a href="#security" class="anchor text-muted"><i class="bi bi-hash"></i></a></h3><p>There are some security improvements that could be made to this configuration, however this is to get you up and running.</p><ol><li>Limit the port access to a specific Source IP Address so that only you can connect<li>Configure better passwords, the ones shown are examples only<li>Consider using a separate bridge so that the VPN has its own filters and rules<li>Change the security of the firewall-auth.txt and home.up files to 600</ol><p>Hopefully this will be helpful to someone out there.</p><p>If you have any issues add a comment below and I will get back to you ASAP.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="bi bi-folder2-open mr-1"></i> <a href="/categories/networking/" >Networking</a ></div><div class="post-tags"> <i class="bi bi-tags mr-1"></i> <a href="/tags/openvpn/" class="post-tag no-text-decoration" >openvpn</a> <a href="/tags/mikrotik/" class="post-tag no-text-decoration" >mikrotik</a> <a href="/tags/linux/" class="post-tag no-text-decoration" >linux</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2" ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Mikrotik%20OpenVPN%20Server%20with%20Linux%20Client%20-%20TotalDebug&url=https%3A%2F%2Ftotaldebug.uk%2Fposts%2Fmikrotik-openvpn-server-with-linux-client%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw bi bi-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Mikrotik%20OpenVPN%20Server%20with%20Linux%20Client%20-%20TotalDebug&u=https%3A%2F%2Ftotaldebug.uk%2Fposts%2Fmikrotik-openvpn-server-with-linux-client%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw bi bi-facebook"></i> </a> <a href="https://telegram.me/share?text=Mikrotik%20OpenVPN%20Server%20with%20Linux%20Client%20-%20TotalDebug&url=https%3A%2F%2Ftotaldebug.uk%2Fposts%2Fmikrotik-openvpn-server-with-linux-client%2F" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw bi bi-telegram"></i> </a> <a href="https://news.ycombinator.com/submitlink?t=Mikrotik%20OpenVPN%20Server%20with%20Linux%20Client%20-%20TotalDebug&u=https%3A%2F%2Ftotaldebug.uk%2Fposts%2Fmikrotik-openvpn-server-with-linux-client%2F" data-toggle="tooltip" data-placement="top" title="HackerNews" target="_blank" rel="noopener" aria-label="HackerNews"> <i class="fa-fw bi bi-hacker-news"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Ftotaldebug.uk%2Fposts%2Fmikrotik-openvpn-server-with-linux-client%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw bi bi-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/what-is-docker-overview/">What is Docker? - Overview</a><li><a href="/posts/docker-install-on-centos-basic-docker-commands/">Docker install on CentOS & basic Docker commands</a><li><a href="/posts/how-i-host-this-site/">How I host this site</a><li><a href="/posts/how-to-make-the-shutdown-button-unavailable-with-group-policy/">How to Make the Shutdown Button Unavailable with Group Policy</a><li><a href="/posts/synchronize-time-with-external-ntp-server-on-windows-server/">Synchronise time with external NTP server on Windows Server</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/centos/">centos</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/unifi/">unifi</a> <a class="post-tag" href="/tags/best-practices/">best practices</a> <a class="post-tag" href="/tags/code-quality/">code quality</a> <a class="post-tag" href="/tags/configuration/">configuration</a> <a class="post-tag" href="/tags/container/">container</a> <a class="post-tag" href="/tags/exchange/">exchange</a> <a class="post-tag" href="/tags/github/">github</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/use-google-authenticator-ssh/"><div class="card-body"> <em class="small" data-ts="1389139200" data-df="ll" > Jan 8, 2014 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Use Google Authenticator for SSH</h3><div class="text-muted small"><p> I have recently setup two factor authentication on my server using Google Authenticator, I thought it would be a good idea to share with you guys the way I achieved this and some issues I bumped in...</p></div></div></a></div><div class="card"> <a href="/posts/proxmox-template-with-cloud-image-and-cloud-init/"><div class="card-body"> <em class="small" data-ts="1664909640" data-df="ll" > Oct 4, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Proxmox Template with Cloud Image and Cloud Init</h3><div class="text-muted small"><p> Using Cloud images and Cloud init with Proxmox is the quickest, most efficient way to deploy servers at this time. Cloud images are small cloud certified that have Cloud init pre-installed and read...</p></div></div></a></div><div class="card"> <a href="/upgrade-linux-unifi-controller-minutes/"><div class="card-body"> <em class="small" data-ts="1488056596" data-df="ll" > Feb 25, 2017 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Upgrade your Linux UniFi Controller in minutes!</h3><div class="text-muted small"><p> Ubiquiti’s provide a Controller version for other distributions of linux but only display debian on their site, but if you’re running CentOS or another Linux distribution, you’ll have to use the ge...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/vmware-transparent-page-sharing-tps/" class="btn btn-outline-primary" prompt="Older"><p>VMware Transparent Page Sharing TPS</p></a> <a href="/posts/vmware-esxi-embedded-host-client-installation/" class="btn btn-outline-primary" prompt="Newer"><p>VMware ESXi Embedded Host Client Installation &#8211; Updated</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "totaldebug/totaldebug.uk", "data-repo-id": "MDEwOlJlcG9zaXRvcnkzMTkxMTkxNTE=", "data-category": "General", "data-category-id": "DIC_kwDOEwVfL84CPpH4", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/centos/">centos</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/unifi/">unifi</a> <a class="post-tag" href="/tags/best-practices/">best practices</a> <a class="post-tag" href="/tags/code-quality/">code quality</a> <a class="post-tag" href="/tags/configuration/">configuration</a> <a class="post-tag" href="/tags/container/">container</a> <a class="post-tag" href="/tags/exchange/">exchange</a> <a class="post-tag" href="/tags/github/">github</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/marksie1988">Steven Marks</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a></p></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button" > <i class="bi bi-chevron-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false" ><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close" > <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3"> A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="bi bi-folder"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="bi bi-tag"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1.11.6/dayjs.min.js,npm/dayjs@1.11.6/locale/en.min.js,npm/dayjs@1.11.6/plugin/relativeTime.min.js,npm/dayjs@1.11.6/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-ZDGYQV98HT"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-ZDGYQV98HT'); }); </script>
