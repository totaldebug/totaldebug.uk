<!DOCTYPE html><html lang="en" data-mode="dark" ><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Use Google Authenticator for SSH" /><meta name="author" content="Steven Marks" /><meta property="og:locale" content="en" /><meta name="description" content="I have recently setup two factor authentication on my server using Google Authenticator, I thought it would be a good idea to share with you guys the way I achieved this and some issues I bumped into along the way." /><meta property="og:description" content="I have recently setup two factor authentication on my server using Google Authenticator, I thought it would be a good idea to share with you guys the way I achieved this and some issues I bumped into along the way." /><link rel="canonical" href="https://totaldebug.uk/posts/use-google-authenticator-ssh/" /><meta property="og:url" content="https://totaldebug.uk/posts/use-google-authenticator-ssh/" /><meta property="og:site_name" content="TotalDebug" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2014-01-08T00:00:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Use Google Authenticator for SSH" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Steven Marks"},"dateModified":"2022-10-27T16:24:01+01:00","datePublished":"2014-01-08T00:00:00+00:00","description":"I have recently setup two factor authentication on my server using Google Authenticator, I thought it would be a good idea to share with you guys the way I achieved this and some issues I bumped into along the way.","headline":"Use Google Authenticator for SSH","mainEntityOfPage":{"@type":"WebPage","@id":"https://totaldebug.uk/posts/use-google-authenticator-ssh/"},"url":"https://totaldebug.uk/posts/use-google-authenticator-ssh/"}</script><title>Use Google Authenticator for SSH | TotalDebug</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="TotalDebug"><meta name="application-name" content="TotalDebug"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous" /><link rel="dns-prefetch" href="https://www.googletagmanager.com" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.3/font/bootstrap-icons.css" /><link rel="stylesheet" href="/assets/css/style.css" /><link rel="stylesheet" href=""><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/logo.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">TotalDebug</a></div><div class="site-subtitle font-italic">Technology. Inside Out</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="bi bi-house ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="bi bi-list-nested ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="bi bi-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="bi bi-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="bi bi-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/works/" class="nav-link"> <i class="bi bi-kanban ml-xl-3 mr-xl-3 unloaded"></i> <span>WORKS</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/marksie1988" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="bi bi-github"></i> </a> <a href="https://www.linkedin.com/in/marksie1988" aria-label="linkedin" target="_blank" rel="noopener noreferrer"> <i class="bi bi-linkedin"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="bi bi-rss"></i> </a> <a href="https://discord.gg/6fmekudc8Q" aria-label="discord" > <i class="bi bi-discord"></i> </a> <a href="https://github.com/marksie1988" aria-label="github" > <i class="bi bi-github"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Use Google Authenticator for SSH</span> </span> <i id="sidebar-trigger" class="bi bi-list"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="bi bi-search"></i> <span id="search-wrapper" class="align-items-center"> <i class="bi bi-search"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Use Google Authenticator for SSH</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1389139200" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jan 8, 2014 </em> </span> <span> Updated <em class="" data-ts="1666884241" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Oct 27, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/marksie1988">Steven Marks</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="860 words"> <em>4 min</em> read</span></div></div></div><div class="post-content"><p>I have recently setup two factor authentication on my server using Google Authenticator, I thought it would be a good idea to share with you guys the way I achieved this and some issues I bumped into along the way.</p><h2 id="install-ntp-to-synchronize-the-system-clock-very-important-or-nothing-will-work"><span class="mr-2">Install NTP to synchronize the system clock (Very important or nothing will work)</span><a href="#install-ntp-to-synchronize-the-system-clock-very-important-or-nothing-will-work" class="anchor text-muted"><i class="bi bi-hash"></i></a></h2><p>Login via ssh as root user. Type the following command to install ntp:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>yum <span class="nb">install </span>ntp
chkconfig ntpd on
ntpdate pool.ntp.org
/etc/init.d/ntpd start
</pre></table></code></div></div><h2 id="install-make-and-disable-selinux"><span class="mr-2">Install make and disable SELinux</span><a href="#install-make-and-disable-selinux" class="anchor text-muted"><i class="bi bi-hash"></i></a></h2><p>Install Make:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>yum <span class="nb">install</span> <span class="nt">-y</span> make
</pre></table></code></div></div><p>Open SE Linux Config for editing:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>vi /etc/sysconfig/selinux
</pre></table></code></div></div><p>Change:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">SELINUX</span><span class="o">=</span>enforcing
</pre></table></code></div></div><p>To:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">SELINUX</span><span class="o">=</span>permissive
</pre></table></code></div></div><p>save the file and then reboot the server.</p><h2 id="install-and-setup-the-google-authentication-pam-module-on-your-server"><span class="mr-2">Install and setup the Google-Authentication PAM module on your server</span><a href="#install-and-setup-the-google-authentication-pam-module-on-your-server" class="anchor text-muted"><i class="bi bi-hash"></i></a></h2><p>Make sure that you have the “<a href="https://fedoraproject.org/wiki/EPEL">link EPEL</a>” repo installed so that you will be able to install everything. I normally install it and then disable it, and only <code class="language-plaintext highlighter-rouge">–enablerepo</code> when it is needed.</p><h5 id="on-centos-5x"><span class="mr-2">On CentOS 5.x</span><a href="#on-centos-5x" class="anchor text-muted"><i class="bi bi-hash"></i></a></h5><p>If you don’t yet have Python 2.6 installed install it: – this will install in in parallel with python2.4 so as not to break yum:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>yum <span class="nt">--enablerepo</span><span class="o">=</span>epel <span class="nb">install </span>python26
</pre></table></code></div></div><p>once installed lets install some dependencies – I have added a couple just in case I need them:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>yum <span class="nt">--enablerepo</span><span class="o">=</span>epel <span class="nb">install </span>gcc gcc++ pam-devel subversion python26-devel
</pre></table></code></div></div><h5 id="on-centos-6x"><span class="mr-2">On Centos 6.x</span><a href="#on-centos-6x" class="anchor text-muted"><i class="bi bi-hash"></i></a></h5><p>You will already have Python 2.6 running so you wont need to install that – lets just install some dependencies in case we need them:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>yum <span class="nt">--enablerepo</span><span class="o">=</span>epel <span class="nb">install </span>gcc gcc++ pam-devel subversion python-devel
</pre></table></code></div></div><h5 id="now-we-need-to-download-and-install-git"><span class="mr-2">Now we need to download and install git</span><a href="#now-we-need-to-download-and-install-git" class="anchor text-muted"><i class="bi bi-hash"></i></a></h5><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>yum <span class="nt">--enablerepo</span><span class="o">=</span>epel <span class="nb">install </span>git
</pre></table></code></div></div><p>Make a directory for the authenticator and go into it:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">mkdir</span> ./google-authenticator
<span class="nb">cd </span>google-authenticator/
</pre></table></code></div></div><p>Download the SVN for google authenticator:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>git clone https://code.google.com/p/google-authenticator/
</pre></table></code></div></div><p>Change to to downloaded directory (on mine I also had to cd into libpam)</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">cd </span>google-authenticator/libpam/
</pre></table></code></div></div><p>Run make and make install:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>make <span class="o">&amp;&amp;</span> make <span class="nb">install</span>
</pre></table></code></div></div><p>If all goes well you should now have the Google-Authentication PAM module on your server, if not then please leave a comment and I will help as best I can 🙂</p><h2 id="setup-pam-authentication-on-the-ssh-server-to-work-with-the-google-authentication-pam-module"><span class="mr-2">Setup PAM authentication on the SSH server to work with the Google-Authentication PAM module</span><a href="#setup-pam-authentication-on-the-ssh-server-to-work-with-the-google-authentication-pam-module" class="anchor text-muted"><i class="bi bi-hash"></i></a></h2><p>Now we need to configure Pam auth for SSH:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>vi /etc/pam.d/sshd
</pre></table></code></div></div><p>change the file to this – basically adding the “auth required pam_google_authenticator.so” line:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="c">#%PAM-1.0</span>
auth required pam_google_authenticator.so
auth include system-auth
account required pam_nologin.so
account include system-auth
password include system-auth
session optional pam_keyinit.so force revoke
session include system-auth
session required pam_loginuid.so
</pre></table></code></div></div><h5 id="skip-two-factor-authentication-if-logging-in-from-the-local-network"><span class="mr-2">Skip two-factor authentication if logging in from the local network</span><a href="#skip-two-factor-authentication-if-logging-in-from-the-local-network" class="anchor text-muted"><i class="bi bi-hash"></i></a></h5><p>At first this is all very cool, but soon it becomes a bit annoying, too. When I SSH from a local network, I just don’t want to enter the verification code because I trust my local network. When I SSH from remote, a verification code is required. One way to arrange that, is always login with certificates. But there is another way to configure it: using the pam_access module. Try this config:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>auth <span class="o">[</span><span class="nv">success</span><span class="o">=</span>1 <span class="nv">default</span><span class="o">=</span>ignore] pam_access.so <span class="nv">accessfile</span><span class="o">=</span>/etc/security/access-local.conf
auth required pam_google_authenticator.so nullok
</pre></table></code></div></div><p>The config file, <code class="language-plaintext highlighter-rouge">/etc/security/access-local.conf</code> looks like:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c"># Two-factor can be skipped on local network</span>
+ : ALL : 10.0.0.0/24
+ : ALL : LOCAL
- : ALL : ALL
</pre></table></code></div></div><p>Local login attempts from 10.0.0.0/24 will not require two-factor authentication, while all others do. Now we need to edit the ssh daemon configuration file.</p><p><code class="language-plaintext highlighter-rouge">vi /etc/ssh/sshd_config</code></p><p>Uncomment:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ChallengeResponseAuthentication <span class="nb">yes</span>
</pre></table></code></div></div><p>Comment out:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="c">#ChallengeResponseAuthentication no</span>
</pre></table></code></div></div><p>Make sure that:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>UsePAM <span class="nb">yes</span>
</pre></table></code></div></div><p>To make your system truly secure – you might want to disable PubkeyAuthentication:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>PubkeyAuthentication no
</pre></table></code></div></div><blockquote class="prompt-warning"><p>NOW STOP and make sure that second SSH session is working because you can then edit <code class="language-plaintext highlighter-rouge">/etc/ssh/sshd_config</code> &amp; <code class="language-plaintext highlighter-rouge">/etc/pam.d/sshd</code> if something goes wrong. Otherwise you are going to need to make these changes on the local console</p></blockquote><p>Restart the SSH daemon:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>service sshd restart
</pre></table></code></div></div><p>Then run the google authenticator on the server by running:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>google-authenticator
</pre></table></code></div></div><p>You should see something like:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="bi bi-code-slash small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="bi bi-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>https://www.google.com/chart?chs<span class="o">=</span>200x200&amp;chld<span class="o">=</span>M%7C0&amp;cht<span class="o">=</span>qr&amp;chl<span class="o">=</span>otpauth://totp/user@server%3Fsecret%3DSAEP64T5VZAVWAFB
Your new secret key is: SAEP64T5VZAVWAFB
Your verification code is 376046
Your emergency scratch codes are:
67868696
26247332
54815527
54336661
</pre></table></code></div></div><p>Answer each of the question to best suit your needs – I said Yes to everything except the “you can increase the window from its default size of 1:30min to about 4min.</p><blockquote class="prompt-info"><p>The emergency scratch codes are one-time use verification codes in the event your phone is unavailable. So save these somewhere safe!</p></blockquote><p>In your browser, load the URL noted above; it will show a QRCode that you can scan into your phone using the Google Authenticator application for Android, iPhone or Blackberry. If you already have a Google Authenticator token being generated on your phone, you can add a new one and it will display them both.</p><ul><li>Start the app on your phone:<li>choose to add by scanning the barcode and then using the url from above in your browser scan the barcode.</ul><p>If all is working you should be able to SSH in with the username, then authentication code from your phone/device and then your password.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="bi bi-folder2-open mr-1"></i> <a href="/categories/linux/" >Linux</a >, <a href="/categories/2fa/" >2FA</a ></div><div class="post-tags"> <i class="bi bi-tags mr-1"></i> <a href="/tags/google/" class="post-tag no-text-decoration" >google</a> <a href="/tags/2fa/" class="post-tag no-text-decoration" >2fa</a> <a href="/tags/linux/" class="post-tag no-text-decoration" >linux</a> <a href="/tags/auth/" class="post-tag no-text-decoration" >auth</a> <a href="/tags/authenticator/" class="post-tag no-text-decoration" >authenticator</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2" ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Use%20Google%20Authenticator%20for%20SSH%20-%20TotalDebug&url=https%3A%2F%2Ftotaldebug.uk%2Fposts%2Fuse-google-authenticator-ssh%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw bi bi-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Use%20Google%20Authenticator%20for%20SSH%20-%20TotalDebug&u=https%3A%2F%2Ftotaldebug.uk%2Fposts%2Fuse-google-authenticator-ssh%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw bi bi-facebook"></i> </a> <a href="https://telegram.me/share?text=Use%20Google%20Authenticator%20for%20SSH%20-%20TotalDebug&url=https%3A%2F%2Ftotaldebug.uk%2Fposts%2Fuse-google-authenticator-ssh%2F" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw bi bi-telegram"></i> </a> <a href="https://news.ycombinator.com/submitlink?t=Use%20Google%20Authenticator%20for%20SSH%20-%20TotalDebug&u=https%3A%2F%2Ftotaldebug.uk%2Fposts%2Fuse-google-authenticator-ssh%2F" data-toggle="tooltip" data-placement="top" title="HackerNews" target="_blank" rel="noopener" aria-label="HackerNews"> <i class="fa-fw bi bi-hacker-news"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Ftotaldebug.uk%2Fposts%2Fuse-google-authenticator-ssh%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw bi bi-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/what-is-docker-overview/">What is Docker? - Overview</a><li><a href="/posts/docker-install-on-centos-basic-docker-commands/">Docker install on CentOS & basic Docker commands</a><li><a href="/posts/how-i-host-this-site/">How I host this site</a><li><a href="/posts/how-to-make-the-shutdown-button-unavailable-with-group-policy/">How to Make the Shutdown Button Unavailable with Group Policy</a><li><a href="/posts/synchronize-time-with-external-ntp-server-on-windows-server/">Synchronise time with external NTP server on Windows Server</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/centos/">centos</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/unifi/">unifi</a> <a class="post-tag" href="/tags/best-practices/">best practices</a> <a class="post-tag" href="/tags/code-quality/">code quality</a> <a class="post-tag" href="/tags/configuration/">configuration</a> <a class="post-tag" href="/tags/container/">container</a> <a class="post-tag" href="/tags/exchange/">exchange</a> <a class="post-tag" href="/tags/github/">github</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div><script src=""></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/proxmox-template-with-cloud-image-and-cloud-init/"><div class="card-body"> <em class="small" data-ts="1664909640" data-df="ll" > Oct 4, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Proxmox Template with Cloud Image and Cloud Init</h3><div class="text-muted small"><p> Using Cloud images and Cloud init with Proxmox is the quickest, most efficient way to deploy servers at this time. Cloud images are small cloud certified that have Cloud init pre-installed and read...</p></div></div></a></div><div class="card"> <a href="/posts/mikrotik-openvpn-server-with-linux-client/"><div class="card-body"> <em class="small" data-ts="1438124400" data-df="ll" > Jul 29, 2015 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Mikrotik OpenVPN Server with Linux Client</h3><div class="text-muted small"><p> I spent quite some time trying to get the OpenVPN Server working on the Mikrotik Router with a Linux client, It caused some pain and I didn’t want others to go through that. I have therefore writte...</p></div></div></a></div><div class="card"> <a href="/upgrade-linux-unifi-controller-minutes/"><div class="card-body"> <em class="small" data-ts="1488056596" data-df="ll" > Feb 25, 2017 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Upgrade your Linux UniFi Controller in minutes!</h3><div class="text-muted small"><p> Ubiquiti’s provide a Controller version for other distributions of linux but only display debian on their site, but if you’re running CentOS or another Linux distribution, you’ll have to use the ge...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/php-notice-undefined-index/" class="btn btn-outline-primary" prompt="Older"><p>PHP Notice: Undefined index</p></a> <a href="/posts/view-virtual-machines-snapshots-vmware/" class="btn btn-outline-primary" prompt="Newer"><p>How to view which Virtual Machines have Snapshots in VMware</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "totaldebug/totaldebug.uk", "data-repo-id": "MDEwOlJlcG9zaXRvcnkzMTkxMTkxNTE=", "data-category": "General", "data-category-id": "DIC_kwDOEwVfL84CPpH4", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/centos/">centos</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/unifi/">unifi</a> <a class="post-tag" href="/tags/best-practices/">best practices</a> <a class="post-tag" href="/tags/code-quality/">code quality</a> <a class="post-tag" href="/tags/configuration/">configuration</a> <a class="post-tag" href="/tags/container/">container</a> <a class="post-tag" href="/tags/exchange/">exchange</a> <a class="post-tag" href="/tags/github/">github</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/marksie1988">Steven Marks</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a></p></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button" > <i class="bi bi-chevron-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false" ><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close" > <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3"> A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="bi bi-folder"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="bi bi-tag"></i>${value}</div>`; } } } }); </script> <script src=""></script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-ZDGYQV98HT"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-ZDGYQV98HT'); }); </script>
